"use strict";!function(a){var b=a.module("app",["ngAnimate","ngCookies","ngSanitize","ngTouch","ui.router"]);b.config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c){b.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}),b.state("product-full",{url:"/product/:productID",templateUrl:"views/main.html",controller:"MainCtrl"}),c.otherwise("/")}]),b.run(["$rootScope",function(a){a.dataUrl="/data/products.json"}])}(window.angular),function(a){var b=a.module("app");b.controller("MainCtrl",["$scope","$state","productsService","$stateParams",function(a,b,c,d){a.updateProducts=function(){c.getAllProducts().then(function(b){a.products=b},function(b){a.error=b})},a.updateProducts(),a.newProduct=function(){a.productID=!1,a.product=c.getDummy()},a.showProduct=function(a){b.go("product-full",{productID:a})},a.productID=d.productID}])}(window.angular),function(a,b,c){var d=a.module("app");d.directive("productPreview",function(){return{replace:!0,templateUrl:"views/product-preview.html"}}),d.directive("productFull",function(){return{replace:!0,templateUrl:"views/product-full.html",controller:"productFullCtrl"}}),d.controller("productFullCtrl",["$scope","$element","$state","productsService",function(a,b,d,e){function f(){h.modal("show")}function g(){h.modal("hide")}var h=c(b);h.on("hidden.bs.modal",function(){a.editMode=!1,a.product=null,a.productID=null,a.dummy=null,d.go("main")}),a.edit=function(){a.dummy=e.getDummy(a.product),a.editMode=!0},a.save=function(){e.updateProduct(a.product,a.dummy),e.saveProduct(a.product),a.editMode=!1,a.dummy=null,a.updateProducts()},a["delete"]=function(){e.deleteProduct(a.product),g(),a.updateProducts()},a.cancel=function(){(!a.editMode||a.product.isDummy)&&(a.product=null,a.productID=null,g()),a.dummy=null,a.editMode=!1},a.$watch("productID",function(b){b&&(a.loading=!0,f(),e.getProduct(b).then(function(b){a.loading=!1,a.product=b}))}),a.$watch("product",function(b){b&&(f(),b.isDummy&&a.edit())}),a.$watch("dummy",function(b){if(b){var c=e.validateProduct(b);a.errors=c.errors,a.dummyHasChanged=!e.productsEqual(b,a.product),a.dummyIsValid=!!c.ok}else a.errors=null,a.dummyHasChanged=null,a.dummyIsValid=null},!0)}])}(window.angular,window._,window.$),function(a,b){var c=a.module("app");c.service("productsService",["$http","$q","$rootScope",function(a,c,d){function e(){return i||(i=a.get(d.dataUrl).then(function(a){try{return g=b.reduce(a.data,function(a,b){var c=parseInt(b.id,10);if(c){if(a[c])throw new Error('duplicate ID "'+b.id+'" in data');return a[c]={id:c,name:b.name||"",description:b.description||"",img:b.img||null,dateAdded:b.dateAdded},h=Math.max(h,c),a}throw new Error('invalid ID "'+b.id+'"! Product IDs must be positive integers')},{})}catch(d){return c.reject(d)}},function(a){return c.reject("Error "+a.status+": "+a.data)})),i}function f(){}var g={},h=0,i=null;this.saveProduct=function(a){var b=this;return c(function(c,d){if(b.validateProduct(a).ok)if(a.id)f(),c("product, "+a.name+"updated.");else{var e=++h;a.id=e,a.dateAdded=+Date.now(),a.isDummy=!1,g[e]=a,f(),c("product, "+a.name+"added. id: "+e)}else d("Product invalid")})},this.getAllProducts=function(){return e().then(function(a){return b.values(a)})},this.getProduct=function(a){return e().then(function(b){return b[a]?b[a]:c.reject("Error 404: product id "+a+" not found")})},this.updateProduct=function(a,b){a.name=b.name,a.description=b.description,a.img=b.img},this.deleteProduct=function(a){return c(function(b,c){g[a.id]?(delete g[a.id],f(),b()):c("Error 404: Product not found")})},this.getDummy=function(a){return a?{name:a.name,description:a.description,img:a.img,isDummy:!0}:{name:"",description:"",img:null,isDummy:!0}},this.productsEqual=function(a,b){return a.name===b.name&&a.description===b.description&&a.img===b.img},this.validateProduct=function(a){var b={},c=a.name,d=a.description;return c?c.length<3?b.name="Product name is too short (minimum 3 characters)":c.length>25&&(b.name="Product name is too long (maximum 25 characters)"):b.name="Product name can't be empty",d?d.length<10?b.description="Product description is too short (minimum 10 characters)":d.length>100&&(b.description="Product description is too long (maximum 100 characters)"):b.description="Product description can't be empty",{errors:b,ok:!b.name&&!b.description}}}])}(window.angular,window._);